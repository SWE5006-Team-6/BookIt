generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ─── Enums ───────────────────────────────────────────────────────────────────

enum UserRole {
  USER
  ADMIN
}

enum BookingStatus {
  CONFIRMED
  CANCELLED
  RELEASED_NO_SHOW
}

// ─── Models ──────────────────────────────────────────────────────────────────

model User {
  id          String   @id @default(uuid())
  email       String   @unique
  displayName String?
  role        UserRole @default(USER)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  createdRooms Room[]
  bookings     Booking[]
}

model Room {
  id          String   @id @default(uuid())
  name        String   @unique
  capacity    Int
  location    String?
  isActive    Boolean  @default(true)
  createdById String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  createdBy User      @relation(fields: [createdById], references: [id])
  bookings  Booking[]
}

model Booking {
  id            String        @id @default(uuid())
  roomId        String
  bookedById    String
  title         String
  startAt       DateTime
  endAt         DateTime
  status        BookingStatus @default(CONFIRMED)
  cancelledAt   DateTime?
  cancelReason  String?
  checkedInAt   DateTime?
  releasedAt    DateTime?
  releaseReason String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Relations
  room     Room @relation(fields: [roomId], references: [id])
  bookedBy User @relation(fields: [bookedById], references: [id])

  // Composite index for efficient room-availability overlap queries
  @@index([roomId, startAt, endAt])
}
